<%
  const page = {
    title: 'Admin — Nutzer anlegen',
    headerTitle: 'Adminbereich',
    styles: ['/css/admin.css'],
    scripts: ['/js/app.js'],
    bodyClass: 'page-admin',
    hideHeader: true,
    hideFooter: true,
    content: function () { %>
    <div class="app-shell">
      <%- include('./nav', { csrfToken, currentUser, activePath }) %>

      <section class="app-main">
        <div class="app-main-header">
          <div>
            <p class="app-main-subtitle">Nutzer anlegen</p>
            <h1>Nutzer erstellen</h1>
            
          </div>
          <a class="btn btn-secondary" href="/admin/users">Zur Nutzerliste</a>
        </div>

        <div class="admin-grid">
          <div class="admin-card" id="single">
            
            <h3>Einzelnen Nutzer erstellen</h3>
            <form class="admin-form vertical" method="POST" action="/admin/users">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <label>E-Mail</label>
              <input name="email" type="email" placeholder="nutzer@schule.at" required>
              <label>Rolle</label>
              <select name="role">
                <option value="student">Schüler</option>
                <option value="teacher">Lehrer</option>
                <option value="admin">Admin</option>
              </select>
              <label>Initial-Passwort</label>
              <div class="admin-row">
                <input name="password" type="password" placeholder="Eigenes Passwort">
                <label class="admin-checkbox">
                  <input type="checkbox" name="useInitial"> Initial-Kennwort aus ENV INITIAL_PASSWORD setzen (nicht fuer Lehrer)
                </label>
              </div>
              <button class="btn btn-primary" type="submit">Anlegen</button>
            </form>
          </div>

          <div class="admin-card" id="bulk">
            
            <h3>Bulk-Anlage</h3>
            <form class="admin-form vertical" method="POST" action="/admin/users/bulk">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <label>E-Mail-Liste (eine Adresse pro Zeile)</label>
              <textarea name="bulkEmails" rows="6" placeholder="max@example.com&#10;lena@example.com" required></textarea>
              <label>Rolle</label>
              <select name="bulkRole">
                <option value="student">Schüler</option>
                <option value="teacher">Lehrer</option>
                <option value="admin">Admin</option>
              </select>
              <label>Passwort-Option</label>
              <div class="admin-row">
                <input name="bulkPassword" type="password" placeholder="Gemeinsames Passwort">
                <label class="admin-checkbox">
                  <input type="checkbox" name="bulkUseInitial"> Initial-Kennwort aus ENV INITIAL_PASSWORD verwenden (nicht fuer Lehrer)
                </label>
              </div>
              <button class="btn btn-secondary" type="submit">Bulk anlegen</button>
            </form>

            <% if (bulkResult) { %>
              <div class="admin-bulk-result">
                <p><strong>Erfolg:</strong> <%= bulkResult.success.length %> Nutzer angelegt.</p>
                <% if (bulkResult.success.length) { %>
                  <ul>
                    <% bulkResult.success.forEach(function(mail){ %>
                      <li><%= mail %></li>
                    <% }) %>
                  </ul>
                <% } %>
                <% if (bulkResult.failed.length) { %>
                  <p><strong>Nicht angelegt:</strong></p>
                  <ul>
                    <% bulkResult.failed.forEach(function(item){ %>
                      <li><%= item.email %> — <%= item.reason %></li>
                    <% }) %>
                  </ul>
                <% } %>
              </div>
            <% } %>
          </div>
        </div>
      </section>
    </div>
<% } }; %>
<%- include('../layout', page) %>
