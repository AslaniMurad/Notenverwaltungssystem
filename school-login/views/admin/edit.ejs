<%
  const page = {
    title: 'Bearbeite Nutzer',
    headerTitle: 'Adminbereich',
    headerActions: [],
    styles: ['/css/admin.css'],
    scripts: ['/js/app.js'],
    bodyClass: 'page-admin-edit',
    hideHeader: true,
    hideFooter: true,
    content: function () { %>
    <div class="app-shell">
      <%- include('./nav', { csrfToken, currentUser, activePath }) %>

      <section class="app-main">
        <div class="app-main-header">
          <div>
            <p class="app-main-subtitle">Bearbeitung</p>
            <h1>Nutzer anpassen</h1>
          </div>
          <a class="admin-button-plain" href="/admin">Zurück</a>
        </div>

        <div class="admin-card-narrow">
          <form class="admin-edit-form" method="POST" action="/admin/users/<%= user.id %>">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">

            <label for="email">E-Mail</label>
            <input id="email" name="email" value="<%= user.email %>" type="email" required>

            <label for="role">Rolle</label>
            <select id="role" name="role">
              <option value="student" <%= user.role === 'student' ? 'selected' : '' %>>Schüler</option>
              <option value="teacher" <%= user.role === 'teacher' ? 'selected' : '' %>>Lehrer</option>
              <option value="admin" <%= user.role === 'admin' ? 'selected' : '' %>>Admin</option>
            </select>

            <label for="status">Status</label>
            <select id="status" name="status">
              <option value="active" <%= user.status === 'active' ? 'selected' : '' %>>active</option>
              <option value="locked" <%= user.status === 'locked' ? 'selected' : '' %>>locked</option>
              <option value="deleted" <%= user.status === 'deleted' ? 'selected' : '' %>>deleted</option>
            </select>

            <button class="btn btn-primary" type="submit">Speichern</button>
          </form>

          <div class="admin-alert muted">Aktueller Status: <strong><%= user.must_change_password ? 'Initial-Passwort aktiv' : 'individuelles Passwort' %></strong></div>

          <hr class="admin-separator">

          <form class="admin-edit-form" method="POST" action="/admin/users/<%= user.id %>/reset">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <label for="password">Neues Passwort</label>
            <input id="password" name="password" type="password" required>
            <button class="btn" type="submit">Passwort zurücksetzen</button>
          </form>

          <form class="admin-edit-form" method="POST" action="/admin/users/<%= user.id %>/delete" onsubmit="return confirm('Nutzer wirklich löschen (soft-delete)?');">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <button class="btn btn-danger" type="submit">Nutzer löschen</button>
          </form>

          <div class="admin-back-link">
            <a class="admin-link" href="/admin">← Zurück zur Übersicht</a>
          </div>
        </div>
      </section>
    </div>
<% } };
%>
<%- include('../layout', page) %>
