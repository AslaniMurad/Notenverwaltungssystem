<%
  const page = {
    title: 'Admin â€” SchÃ¼ler hinzufÃ¼gen',
    headerTitle: 'Adminbereich',
    styles: ['/css/admin.css'],
    scripts: ['/js/app.js'],
    bodyClass: 'page-admin',
    hideHeader: true,
    hideFooter: true,
    content: function () { %>
    <div class="app-shell">
      <%- include('./nav', { csrfToken, currentUser, activePath }) %>

      <section class="app-main">
        <div class="app-main-header">
          <div>
            <p class="app-main-subtitle">Klasse <%= classData.name %></p>
            <h1>SchÃ¼ler hinzufÃ¼gen</h1>
            <p class="admin-muted">Nur registrierte SchÃ¼ler kÃ¶nnen zugeordnet werden.</p>
          </div>
          <a class="btn btn-secondary" href="/admin/classes/<%= classData.id %>/students">ZurÃ¼ck</a>
        </div>

        <div class="admin-card-narrow">
          <% if (error) { %>
            <div class="admin-alert"><%= error %></div>
          <% } %>
          <% if (bulkResult) { %>
            <div class="admin-alert">
              Bulk Ergebnis: <%= bulkResult.success.length %> hinzugefuegt, <%= bulkResult.failed.length %> fehlgeschlagen.
            </div>
            <% if (bulkResult.failed.length) { %>
              <div class="admin-alert">
                <p>Fehlgeschlagen:</p>
                <ul>
                  <% bulkResult.failed.forEach((entry) => { %>
                    <li><%= entry.email %> - <%= entry.reason %></li>
                  <% }); %>
                </ul>
              </div>
            <% } %>
          <% } %>
          <form class="admin-edit-form" method="POST" action="/admin/classes/<%= classData.id %>/students/add">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">

            <label for="name">Name</label>
            <input id="name" name="name" type="text" data-student-name>
            <p class="admin-muted">Wird automatisch gesetzt bei E-Mail im Format vorname.nachname@xy.</p>

            <label for="email">E-Mail</label>
            <input id="email" name="email" type="email" required data-student-email>

            <button class="btn btn-primary" type="submit">HinzufÃ¼gen</button>
          </form>
        </div>

        <div class="admin-card-narrow">
          <h3>Bulk Schueler hinzufuegen</h3>
          <p class="admin-muted">Eine E-Mail pro Zeile. Name wird aus vorname.nachname@xy abgeleitet.</p>
          <form class="admin-edit-form" method="POST" action="/admin/classes/<%= classData.id %>/students/add-bulk">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">

            <label for="bulkEmails">E-Mails (eine pro Zeile)</label>
            <textarea id="bulkEmails" name="bulkEmails" rows="6" required></textarea>

            <button class="btn btn-primary" type="submit">Bulk hinzufuegen</button>
          </form>
        </div>
      </section>
    </div>
<% } }; %>
<%- include('../layout', page) %>





